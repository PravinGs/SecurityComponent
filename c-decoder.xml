<!-- Auditd
163
164   - Will extract action, id, status, extra_data, srcip
165   - Author and (c): Michael Starks, 2011
166   - Future enhancements should ensure that all log samples regress properly due to the complexity of these decoders
167   - Examples:

<!-- CentOS 5.5 -->
type=USER_ACCT msg=audit(1310592861.936:1222): user pid=24675 uid=0 auid=501 ses=188 subj=system_u:system_r:unconfined_t:s0 msg='op=PAM:accounting acct="username" exe="/usr/bin/sudo" (hostname=?, addr=?, terminal=pts/5 res=success)'
type=CRED_ACQ msg=audit(1305666154.831:51859): user pid=21250 uid=0 auid=4294967295 subj=system_u:system_r:unconfined_t:s0-s0:c0.c1023 msg='PAM: setcred acct="username" : exe="/usr/sbin/sshd" (hostname=lala.example.com, addr=172.16.0.1, terminal=ssh res=success)'
type=CRED_ACQ msg=audit(1273182001.226:148635): user pid=29770 uid=0 auid=4294967295 subj=system_u:system_r:crond_t:s0-s0:c0.c1023 msg='PAM: setcred acct="root" : exe="/usr/sbin/crond" (hostname=?, addr=?, terminal=cron
type=USER_AUTH msg=audit(1305666163.690:51871): user pid=21269 uid=0 auid=500 subj=user_u:system_r:unconfined_t:s0 msg='PAM: authentication acct="root" : exe="/bin/su" (hostname=?, addr=?, terminal=pts/0 res=success)'
type=USER_ACCT msg=audit(1306939201.750:67934): user pid=4401 uid=0 auid=4294967295 subj=system_u:system_r:crond_t:s0-s0:c0.c1023 msg='PAM: accounting acct="root" : exe="/usr/sbin/crond" (hostname=?, addr=?, terminal=cron res=success)'
type=CRED_ACQ msg=audit(1306939201.751:67935): user pid=4401 uid=0 auid=4294967295 subj=system_u:system_r:crond_t:s0-s0:c0.c1023 msg='PAM: setcred acct="root" : exe="/usr/sbin/crond" (hostname=?, addr=?, terminal=cron res=success)'
type=USER_START msg=audit(1306939201.756:67937): user pid=4401 uid=0 auid=0 subj=system_u:system_r:crond_t:s0-s0:c0.c1023 msg='PAM: session open acct="root" : exe="/usr/sbin/crond" (hostname=?, addr=?, terminal=cron res=success)'
type=USER_CHAUTHTOK msg=audit(1304523288.952:37394): user pid=7258 uid=0 auid=500 subj=user_u:system_r:unconfined_t:s0 msg='op=change password id=505 exe="/usr/bin/passwd" (hostname=?, addr=?, terminal=pts/1 res=success)'

<!-- Unknown source -->
type=USER_ACCT msg=audit(1310592861.936:1222): user pid=24675 uid=0 auid=501 ses=188 subj=system_u:system_r:unconfined_t:s0 msg='op=PAM:accounting acct="username" exe="/usr/bin/sudo" (hostname=?, addr=?, terminal=pts/5 res=success)'

<!-- Ubuntu 10.04 LTS -->
type=SYSCALL msg=audit(1307045440.943:148): arch=c000003e syscall=59 success=yes exit=0 a0=de1fa8 a1=de23a8 a2=dc3008 a3=7fff1db3cc60 items=2 ppid=11719 pid=12140 auid=4294967295 uid=0 gid=0 euid=0 suid=0 fsuid=0 egid=0 sgid=0 fsgid=0 tty=pts8 ses=4294967295 comm="wget" exe="/tmp/wget" key="webserver-watch-tmp"
type=SYSCALL msg=audit(1307045820.403:151): arch=c000003e syscall=59 success=no exit=-13 a0=de24c8 a1=de2408 a2=dc3008 a3=7fff1db3cc60 items=1 ppid=11719 pid=12347 auid=4294967295 uid=0 gid=0 euid=0 suid=0 fsuid=0 egid=0 sgid=0 fsgid=0 tty=pts8 ses=4294967295 comm="bash" exe="/bin/bash" key=(null)
type=SYSCALL msg=audit(1306939143.715:67933): arch=40000003 syscall=94 success=yes exit=0 a0=5 a1=180 a2=8ebd360 a3=8ec4978 items=1 ppid=4383 pid=4388 auid=500 uid=0 gid=0 euid=0 suid=0 fsuid=0 egid=0 sgid=0 fsgid=0 tty=pts0 ses=8038 comm="less" exe="/usr/bin/less" subj=user_u:system_r:unconfined_t:s0 key="perm_mod"
type=USER_ROLE_CHANGE msg=audit(1280266360.845:51): user pid=1978 uid=0 auid=500 subj=system_u:system_r:local_login_t:s0-s0:c0.c1023 msg='pam: default-context=user_u:system_r:unconfined_t:s0 selected-context=user_u:system_r:unconfined_t:s0: exe="/bin/login" (hostname=?, addr=?, terminal=tty1 res=success)'
type=PATH msg=audit(1306967989.163:119): item=0 name="./ls" inode=261813 dev=fb:00 mode=0100755 ouid=0 ogid=0 rdev=00:00

<!-- Will not decode due to null name, that's OK -->
type=PATH msg=audit(1273924468.947:179534): item=0 name=(null) inode=424783 dev=fd:07 mode=0100640 ouid=0 ogid=502 rdev=00:00 obj=user_u:object_r:file_t:s0

-->

<decoder name="auditd">
  <prematch_pcre2>^type=</prematch_pcre2>
</decoder>

<!-- SELinux -->
<decoder name="auditd-selinux">
  <parent>auditd</parent>
  <prematch_pcre2 offset="after_parent">^AVC </prematch_pcre2>
  <pcre2 offset="after_parent">^(AVC) msg=audit\(\d{10}\.\d{3}:(\d+?)\): avc:  (\S+)  \{ .+ \} for  pid=\d+? comm="(\S+)" path="\S+" dev=\S+ ino=\d+? scontext=\S+ tcontext=\S+ tclass=\S+$</pcre2>
  <order>action,id,status,extra_data</order>
</decoder>

<!-- syscall -->
<decoder name="auditd-syscall">
  <parent>auditd</parent>
  <prematch_pcre2 offset="after_parent">^SYSCALL </prematch_pcre2>
  <pcre2 offset="after_parent">^(SYSCALL) msg=audit\(\d{10}\.\d{3}:(\d+?)\): arch=\w+ syscall=\d+ success=(\S+) exit=\S+ a0=\w+ a1=\w+ a2=\w+ a3=\w+ items=\d+ ppid=\d+ pid=\d+ auid=\d+ uid=\d+ gid=\d+ euid=\d+ suid=\d+ fsuid=\d+ egid=\d+ sgid=\d+ fsgid=\d+ tty=\S+ ses=\d+ comm="\S+" exe="(.+?)"</pcre2>
  <order>action,id,status,extra_data</order>
</decoder>

<!-- config -->
<decoder name="auditd-config">
  <parent>auditd</parent>
  <prematch_pcre2 offset="after_parent">^CONFIG_CHANGE </prematch_pcre2>
  <pcre2 offset="after_parent">^(CONFIG_CHANGE) msg=audit\(\d{10}\.\d{3}:(\d+?)\): auid=\d+? ses=\d+? op=".+" path="(.+)" key="\S+" list=\d+? res=\d+?$</pcre2>
  <order>action,id,extra_data</order>
</decoder>

<!-- path (will only decode if name is not null)-->
<decoder name="auditd-path">
  <parent>auditd</parent>
  <prematch_pcre2 offset="after_parent">^PATH </prematch_pcre2>
  <pcre2 offset="after_parent">^(PATH) msg=audit\(\d{10}\.\d{2}:(\d+?)\): item=\d+? name="(.+)" inode=\d+? dev=\S+ mode=\d+? ouid=\d+? ogid=\d+? rdev=\S+</pcre2>
  <order>action,id,extra_data</order>
</decoder>

<!-- user-related -->
<decoder name="auditd-user">
  <parent>auditd</parent>
  <pcre2 offset="after_parent">^(USER_\S+) msg=audit\(\d{10}\.\d{3}:(\d+?)\): user pid=\d+? uid=\d+? auid=\d+|</pcre2>
  <pcre2>^(CRED_\S+) msg=audit\(\d{10}\.\d{3}:(\d+?)\): user pid=\d+? uid=\d+? auid=\d+</pcre2>
  <order>action,id</order>
</decoder>

<decoder name="auditd-user">
  <parent>auditd</parent>
  <pcre2 offset="after_regex"> acct="(.+)" : exe="(.+)" \(hostname=\S+, addr=(\S+), terminal=\S+$</pcre2>
  <order>user,extra_data,srcip</order>
</decoder>

<decoder name="auditd-user">
  <parent>auditd</parent>
  <pcre2 offset="after_regex"> ses=\d+? subj=\S+ msg='.+ acct="(.+)" exe="(.+)" hostname=\S+ addr=(\S+) terminal=\S+ res=(\S+)$</pcre2>
  <order>user,extra_data,srcip,status</order>
</decoder>

<decoder name="auditd-user">
  <parent>auditd</parent>
  <pcre2 offset="after_regex"> subj=\S+ msg='.+ acct="(.+)" :*[ ]*?exe="(.+)" \(hostname=\S+, addr=(\S+), terminal=\S+ res=(\S+)\)'$</pcre2>
  <order>user,extra_data,srcip,status</order>
</decoder>

<decoder name="auditd-user">
  <parent>auditd</parent>
  <pcre2 offset="after_regex"> subj=\S+ msg='.+ exe="(.+)" \(hostname=\S+, addr=(\S+), terminal=\S+ res=(\S+)\)'$</pcre2>
  <order>extra_data,srcip,status</order>
</decoder>

<!--
mptscsih \ mptbase decoder

Description: module for SCSI controllers.

Examples:
[ 5008.286061] mptscsih: ioc0: task abort: FAILED (rv=2003) (sc=ffff88007a8a9f00)

[ 6498.769248] mptbase: ioc0: RAID STATUS CHANGE for PhysDisk 1 id=8
[ 6498.769252] mptbase: ioc0:   PhysDisk is now failed, out of sync

[ 6498.775783] mptbase: ioc0: RAID STATUS CHANGE for VolumeID 0
[ 6498.775788] mptbase: ioc0:   volume is now degraded, enabled
-->
<decoder name="mptscsih-1">
  <parent>iptables</parent>
  <prematch_pcre2>^\[ \d+\.\d+\] mptscsih: </prematch_pcre2>
  <pcre2>^\[ \d+\.\d+\] (\w+): (\w+): task abort: (\w+)</pcre2>
  <order>id,data,status</order>
</decoder>

<decoder name="mptbase-1">
  <parent>iptables</parent>
  <prematch_pcre2>^\[ \d+\.\d+\] mptbase: </prematch_pcre2>
  <pcre2>^\[ \d+\.\d+\] (\w+): (\w+):[ ]+[A-Za-z0-9@_-]+ is now (\w+), (\D+)$</pcre2>
  <order>id,data,action,status</order>
</decoder>

<!-- Grandstream HT502 VoIP gateway decoder
Author and (c): Michael Starks, 2014 -->

<!-- HT502: [00:0B:82:14:5B:94] Transport error (-1) for transaction 2677 -->

<decoder name="grandstream-ata">
 <prematch_pcre2>^HT286: \[\w\w:\w\w:\w\w:\w\w:\w\w:\w\w\][()*+,.:;\<=>?\[\]!"'#%&$|{}-]*?.+[()*+,.:;\<=>?\[\]!"'#%&$|{}-]* |</prematch_pcre2>
 <prematch_pcre2>^HT502: \[\w\w:\w\w:\w\w:\w\w:\w\w:\w\w\][()*+,.:;\<=>?\[\]!"'#%&$|{}-]*?.+[()*+,.:;\<=>?\[\]!"'#%&$|{}-]* |</prematch_pcre2>
 <prematch_pcre2>^HT503: \[\w\w:\w\w:\w\w:\w\w:\w\w:\w\w\][()*+,.:;\<=>?\[\]!"'#%&$|{}-]*?.+[()*+,.:;\<=>?\[\]!"'#%&$|{}-]* </prematch_pcre2>
</decoder>

<decoder name="grandstream-registration">
 <parent>grandstream-ata</parent>
 <prematch_pcre2>Received </prematch_pcre2>
 <pcre2 offset="after_prematch">^(\d+) response for transaction (\d+?)\(([A-Za-z0-9@_-]+)\)$</pcre2>
 <order>status, id, action</order>
</decoder>

<decoder name="grandstream-fts-registered">
 <parent>grandstream-ata</parent>
 <prematch_pcre2>Account </prematch_pcre2>
 <pcre2 offset="after_prematch">^(\d+) (registered), tried \d+; Next registration in \d+ seconds \(\d+/\d+\) on (.+)$</pcre2>
 <order>id, status, extra_data</order>
 <fts>name, location, extra_data</fts>
</decoder>

<decoder name="grandstream-incoming-cid">
 <parent>grandstream-ata</parent>
 <prematch_pcre2>Vinetic::</prematch_pcre2>
 <pcre2 offset="after_prematch">^(startRing) with CID, Attempting to deliver CID (\d+) on port \d+$</pcre2>
 <order>action, id</order>
</decoder>

<decoder name="grandstream-outgoing-call">
 <parent>grandstream-ata</parent>
 <pcre2 offset="after_parent">^(Dialing) (\d+)$</pcre2>
 <order>action, id</order>
</decoder>


<!-- apparmor
  - Jun 24 10:35:29 hostname kernel: [49787.970285] audit: type=1400 audit(1403598929.839:88986): apparmor="ALLOWED" operation="getattr" profile="/usr/sbin/dovecot//null-1//null-2//null-4a6" name="/home/admin/mails/new/" pid=19973 comm="imap" requested_mask="r" denied_mask="r" fsuid=1003 ouid=1003
  - Jul 14 11:03:47 hostname kernel: [ 8665.951930] type=1400 audit(1405328627.702:54): apparmor="DENIED" operation="open" profile="/usr/bin/evince" name="/etc/xfce4/defaults.list" pid=16418 comm="evince" requested_mask="r" denied_mask="r" fsuid=1000 ouid=0
  - Jun 16 17:37:39 hostname kernel: [891880.587623] audit: type=1400 audit(1402933059.038:1681857): apparmor="ALLOWED" operation="exec" profile="/usr/sbin/dovecot//null-1fde//null-1fdf" name="/usr/lib/dovecot/pop3-login" pid=13903 comm="dovecot" requested_mask="x" denied_mask="x" fsuid=0 ouid=0 target="/usr/sbin/dovecot//null-1fde//null-1fdf//null-6b18"
  - Jun 16 17:37:39 hostname kernel: [891880.587957] audit: type=1400 audit(1402933059.038:1681858): apparmor="ALLOWED" operation="open" profile="/usr/sbin/dovecot//null-1fde//null-1fdf//null-6b18" name="/usr/lib/dovecot/libdovecot-login.so.0.0.0" pid=13903 comm="pop3-login" requested_mask="r" denied_mask="r" fsuid=0 ouid=0
  - Jun 16 17:37:39 hostname kernel: [891880.587976] audit: type=1400 audit(1402933059.038:1681859): apparmor="ALLOWED" operation="getattr" profile="/usr/sbin/dovecot//null-1fde//null-1fdf//null-6b18" name="/usr/lib/dovecot/libdovecot-login.so.0.0.0" pid=13903 comm="pop3-login" requested_mask="r" denied_mask="r" fsuid=0 ouid=0
  - Jun 16 17:37:39 hostname kernel: [891880.587989] audit: type=1400 audit(1402933059.038:1681860): apparmor="ALLOWED" operation="file_mmap" profile="/usr/sbin/dovecot//null-1fde//null-1fdf//null-6b18" name="/usr/lib/dovecot/libdovecot-login.so.0.0.0" pid=13903 comm="pop3-login" requested_mask="mr" denied_mask="mr" fsuid=0 ouid=0
  - Jun 23 20:46:15 hostname kernel: [   11.103248] audit: type=1400 audit(1403549175.177:2): apparmor="STATUS" operation="profile_load" name="/sbin/klogd" pid=2185 comm="apparmor_parser"
  - Jun 16 17:37:39 hostname kernel: [891880.587989] audit: type=1400 audit(1314853822.672:33649): apparmor="DENIED" operation="mknod" parent=27250 profile="/usr/lib/apache2/mpm-prefork/apache2//example.com" name="/usr/share/wordpress/1114140474e5f13bea68a4.tmp" pid=27289 comm="apache2" requested_mask="c" denied_mask="c" fsuid=33 ouid=33
  - Jun 16 17:37:39 hostname kernel: [891880.587989] audit: type=1400 audit(1315353795.331:33657): apparmor="DENIED" operation="exec" parent=14952 profile="/usr/lib/apache2/mpm-prefork/apache2//example.com" name="/usr/lib/sm.bin/sendmail" pid=14953 comm="sh" requested_mask="x" denied_mask="x" fsuid=33 ouid=0
-->

<decoder name="apparmor">
  <parent>iptables</parent>
  <prematch_pcre2> apparmor=</prematch_pcre2>
  <pcre2> apparmor="(\S+)" operation="(\S+)"</pcre2>
  <order>status, extra_data</order>
</decoder>

<!-- unix_chkpwd
  - Jul 21 07:40:29 localhost unix_chkpwd[15804]: password check failed for user (username)
-->
<decoder name="unix_chkpwd">
  <program_name_pcre2>^unix_chkpwd</program_name_pcre2>
</decoder>

<!--Jul 21 07:40:29 localhost unix_chkpwd[15804]: password check failed for user (username)-->
<decoder name="chkpwd-user">
  <parent>unix_chkpwd</parent>
  <pcre2 offset="after_parent">user \(([A-Za-z0-9@_-]+)\)$</pcre2>
  <order>srcuser</order>
</decoder>

<!-- Barracuda S&VF Email Logs
Examples:
May 14 03:31:21 mx1.example.org inbound/pass1: mail-88-66.reachmail.net[216.55.88.66] 1400074281-06f4a338c037a90001-TkCAQV 1400074281 1400074283 RECV errors@mail-88-68.reachmail.net eteixeira@example.net 2 12 -
May 15 14:09:17 mx1.example.org inbound/pass1: host.limitless-servers.com[192.208.186.41] 1400198954-06f4a338c062640001-BkZagu 1400198954 1400198958 SCAN - heartattackbreakthrough@ridchanceofhrtattk.us en@example.org - 2 74 ridchanceofhrtattk.us SZ:2557 SUBJ:THE #1 Trick to Prevent Heart-Attacks Revealed???
May 16 10:12:29 mx1.example.org inbound/pass1: kumarafoundation.hestoe.com[208.123.118.114] 1400271149-06f4a338c07a210001-QwTJwG 1400271149 1400271151 SCAN - EzekielMack@kumarafoundation.hestoe.com ctakesue@example.org - 2 74 hestoe.com SZ:1917 SUBJ:Bad Economy, Bad Rates - Get An Auto Insurance Quotes Today
May 13 01:20:44 mx1.example.org scan: salmon.emxp002.net[174.123.35.182] 1399980039-06f4a338c019db0001-ZAPlzU 1399980040 1399980045 SCAN - errors@mermaid.emxp002.net PTAUA@HINGYCA.ORG 1.636 0 0 - SZ:86808 SUBJ:ATTN PASILA: URGENT FUNDING AVAILABLE
May 14 09:39:30 mx1.example.org scan: mc.eau.lormaneducation.com[64.198.99.4] 1400096370-06f4a338c040390001-vQoliC 1400096370 1400096372 SCAN - bounce-201405143661297864@mc.eau.lormaneducation.com tmoriyasu@dod.hawaii.gov 0.401 0 0 - SZ:22001 SUBJ:Contractor's Dilemma of Dealing With Bad Plans and Specs - OnDemand Webinar
May 16 10:56:04 mx1.example.org scan: smtp133.elabs13.com[74.116.235.133] 1400273757-06f4a338c07b490001-CBNzJg 1400273757 1400273765 SCAN - newsletter@email.cnbc.com tcolwell@example.net 0.402 0 0 - SZ:26609 SUBJ:=?utf-8?Q?"Failure=20to=20Recall:=20Investigating=20GM"=20Premier?==?utf-8?Q?es=20Sunday=2010p=20ET/PT?=
Jul 26 10:39:36 mx1.example.org outbound/smtp: 127.0.0.1 1406407176-06f4a35b4d10f2c0001-EGYtgK 0 0 SEND - 3 A90EBA1F1BA connect to dnvrco-pub-iedge-vip.email.rr.com[107.14.73.70]: server refused mail service
Jul 26 13:38:16 mx1.example.org outbound/smtp: 127.0.0.1 1406248798-06f4a35b4de6bd0001-3QeedR 0 0 SEND - 3 68EC0A1F1A3 Name service error for name=conference.preventchildabusetexas.org type=MX: Host not found, try again
Jul 26 13:57:56 mx1.example.org outbound/smtp: 127.0.0.1 1406297159-06f4a35b4df2000001-PDxQZ2 0 0 SEND - 3 A194BA1F1AC connect to qw.eau.lormanwebinars.com[63.232.201.60]: Connection refused
-->

<decoder name="barracuda-svf-email">
  <program_name_pcre2>^inbound/pass|^scan|^outbound/smtp</program_name_pcre2>
</decoder>

<decoder name="barracuda-svf1">
  <parent>barracuda-svf-email</parent>
  <prematch_pcre2>^\S+\[\S+\]|</prematch_pcre2>
  <prematch_pcre2>^\S+</prematch_pcre2>
  <pcre2>^\S+\[(\S+)\] (\d+-[A-Za-z0-9@_-]+?-[A-Za-z0-9@_-]+) \d+ \d+ |</pcre2>
  <pcre2>^(\S+) (\d+-[A-Za-z0-9@_-]+?-[A-Za-z0-9@_-]+) \d+ \d+ </pcre2>
  <order>srcip, id</order>
</decoder>

<!-- Info section - SCAN -->
<decoder name="barracuda-svf1">
  <parent>barracuda-svf-email</parent>
  <pcre2 offset="after_regex">(SCAN) (\S+ \S+ \S+ \S+ \d+ \d+ .+ SUBJ:.+)$</pcre2>
  <order>action, extra_data</order>
</decoder>

<!-- Info section RECV -->
<decoder name="barracuda-svf1">
  <parent>barracuda-svf-email</parent>
  <pcre2 offset="after_regex">(RECV) (\S+ \S+ \d+ \d+ .+)$</pcre2>
  <order>action, extra_data</order>
</decoder>

<!-- Info section SEND -->
<decoder name="barracuda-svf1">
  <parent>barracuda-svf-email</parent>
  <pcre2 offset="after_regex">(SEND) (\S+ \d+ \S+ .+)$</pcre2>
  <order>action, extra_data</order>
</decoder>

<!-- Barracuda S&VF Administration-->

<decoder name="barracuda-svf-admin">
  <program_name_pcre2>^web</program_name_pcre2>
</decoder>

<decoder name="barracuda-svf-admin-change">
  <parent>barracuda-svf-admin</parent>
  <prematch_pcre2>^\[\S+\] global\[\] CHANGE</prematch_pcre2>
  <pcre2 offset="after_parent">^\[(\S+)\] global\[\] (CHANGE) (\S+ \(\S*)\)$</pcre2>
  <order>srcip,action,extra_data</order>
</decoder>

<decoder name="barracuda-svf-admin-auth">
  <parent>barracuda-svf-admin</parent>
  <prematch_pcre2>^\[\S+\] LOGIN|</prematch_pcre2>
  <prematch_pcre2>^\[\S+\] FAILED_LOGIN|</prematch_pcre2>
  <prematch_pcre2>^\[\S+\] LOGOUT</prematch_pcre2>
  <pcre2 offset="after_parent">^\[(\S+)\] (\S+) \((\S+)\)[()*+,.:;\<=>?\[\]!"'#%&$|{}-]*$</pcre2>
  <order>srcip,action,user</order>
</decoder>


<!-- 
  - Decoder for Sysmon Event ID 1: Process Created
  - Maintained by Josh Brower, Josh@DefensiveDepth.com 
  -
  -  OSSEC to Sysmon Fields Mapping:
  -  user = User
  -  status = Image
  -  url = Hash
  -  extra_data = ParentImage
  
  - Examples:
  - 2014 Dec 20 14:29:48 (HME-TEST-01) 10.0.15.14->WinEvtLog 2014 Dec 20 09:29:47 WinEvtLog: Microsoft-Windows-Sysmon/Operational: INFORMATION(1): Microsoft-Windows-Sysmon: SYSTEM: NT AUTHORITY: WIN-U93G48C7BOP: Process Create:  UtcTime: 12/20/2014 2:29 PM  ProcessGuid: {00000000-87DB-5495-0000-001045F25A00}  ProcessId: 3048  Image: C:\Windows\system32\svchost.exe  CommandLine: "C:\Windows\system32\NOTEPAD.EXE" C:\Users\Administrator\Desktop\ossec.log  User: WIN-U93G48C7BOP\Administrator  LogonGuid: {00000000-84B8-5494-0000-0020CB330200}  LogonId: 0x233CB  TerminalSessionId: 1  IntegrityLevel: High  HashType: SHA1  Hash: 9FEF303BEDF8430403915951564E0D9888F6F365  ParentProcessGuid: {00000000-84B9-5494-0000-0010BE4A0200}  ParentProcessId: 848  ParentImage: C:\Windows\Explorer.EXE  ParentCommandLine: C:\Windows\Explorer.EXE 
-->

<decoder name="Sysmon-EventID#1">
<type>windows</type>
<prematch_pcre2>INFORMATION\(1\)</prematch_pcre2>
<pcre2 offset="after_prematch">Image: (.*?) [ ]*?CommandLine: .*? [ ]*?User: (.*?) [ ]*?LogonGuid: \S*? [ ]*?LogonId: \S*? [ ]*?TerminalSessionId: \S*? [ ]*?IntegrityLevel: .*?HashType: \S*? [ ]*?Hash: (\S*?) [ ]*?ParentProcessGuid: \S*? [ ]*?ParentProcessID: \S*? [ ]*?ParentImage: (.*?) [ ]*?ParentCommandLine:</pcre2>
<order>status,user,url,data</order>
</decoder>

<!-- Squid access log decoder.
  - Will extract the srcip.
  - Author: Ahmet Ozturk
  - Examples:
  - 1140701044.525   1231 192.168.1.201 TCP_DENIED/400 1536
    GET ahmet - NONE/- text/html
  - 1140701230.827    781 192.168.1.210 TCP_DENIED/407 1785
    GET http://www.ossec.net oahmet NONE/- text/html
  -->
<decoder name="squid-accesslog">
  <type>squid</type>
  <prematch_pcre2>^\d+? \S+ </prematch_pcre2>
  <pcre2>^\d+? (\S+) ([A-Za-z0-9@_-]+?)/(\d+?) \d+? [A-Za-z0-9@_-]+? (\S+) </pcre2>
  <order>srcip,action,id,url</order>
</decoder>

<!-- unbound
  - 2014-05-20T09:01:07.283219-04:00 arrakis unbound: [9405:0] notice: sendto failed: Can't assign requested address
  - 2014-07-14T14:00:02.814490-04:00 arrakis unbound: [2541:0] info: 127.0.0.1 talkgadget.google.com. A IN
  - 2014-07-14T14:00:05.507848-04:00 arrakis unbound: [2541:0] info: server stats for thread 0: 3 queries, 2 answers from cache, 1 recursions, 0 prefetch
  - 2014-07-14T14:00:05.507955-04:00 arrakis unbound: [2541:0] info: server stats for thread 0: requestlist max 0 avg 0 exceeded 0 jostled 0
  - 2014-07-14T14:00:05.508075-04:00 arrakis unbound: [2541:0] info: average recursion processing time 0.038814 sec
  - 2014-07-14T14:00:05.508166-04:00 arrakis unbound: [2541:0] info: histogram of recursion processing times
  - 2014-07-14T14:00:05.508248-04:00 arrakis unbound: [2541:0] info: [25%]=0 median[50%]=0 [75%]=0
  - 2014-07-14T14:00:05.508333-04:00 arrakis unbound: [2541:0] info: lower(secs) upper(secs) recursions
  - 2014-07-14T14:00:05.508414-04:00 arrakis unbound: [2541:0] info:    0.032768    0.065536 1
  - 2014-07-14T15:05:07.520229-04:00 arrakis unbound: [2541:0] info: 127.0.0.1 github.com. AAAA IN
-->


<decoder name="unbound">
  <program_name_pcre2>^unbound</program_name_pcre2>
</decoder>

<decoder name="unbound-a">
  <parent>unbound</parent>
  <pcre2> info: (\S+) (\S+)\. A IN$| info: (\S+) (\S+) AAAA IN$</pcre2>
  <order>srcip,url</order>
</decoder>

<!-- OpenBSD doas -->
<decoder name="doas">
  <program_name_pcre2>^doas</program_name_pcre2>
</decoder>

<decoder name="doas-user">
  <parent>doas</parent>
  <pcre2>^(\S+) ran| for (\S+):</pcre2>
  <order>srcuser</order>
</decoder>

<decoder name="doas-user">
  <parent>doas</parent>
  <pcre2 offset="after_parent"> as (\S+): </pcre2>
  <order>dstuser</order>
</decoder>

<!-- Exim
  - Examples:
  - 2017-01-23 03:44:14 dovecot_login authenticator failed for (hydra) [10.101.1.18]:35686: 535 Incorrect authentication data (set_id=user)
  - 2017-01-24 05:22:29 dovecot_plain authenticator failed for (test) [::1]:39454: 535 Incorrect authentication data (set_id=test)
  - 2017-01-24 03:09:46 SMTP connection from [10.101.1.10]:55010 (TCP/IP connection count = 1)
  - 2017-01-24 02:53:13 SMTP connection from (hydra) [10.101.1.10]:53682 lost
  - 2017-01-24 05:36:23 SMTP call from (000000) [::1]:39480 dropped: too many syntax or protocol errors (last command was "123")
-->

<decoder name="exim-authfailed">
  <parent>windows-date-format</parent>
  <prematch_pcre2 offset="after_parent">authenticator failed</prematch_pcre2>
  <pcre2 offset="after_prematch">\[(\S+)\]:\d+: \d+ Incorrect authentication data \(set_id=([A-Za-z0-9@_-]+?)\)</pcre2>
  <order>srcip,user</order>
</decoder>

<decoder name="exim-connect">
  <parent>windows-date-format</parent>
  <prematch_pcre2 offset="after_parent">^SMTP connection from </prematch_pcre2>
  <pcre2 offset="after_prematch">\[(\S+)\]:\d+ \(TCP/IP connection count</pcre2>
  <order>srcip</order>
</decoder>

<decoder name="exim-disconnect">
  <parent>windows-date-format</parent>
  <prematch_pcre2 offset="after_parent">^SMTP connection from </prematch_pcre2>
  <pcre2 offset="after_prematch">\[(\S+)\]:\d+ lost</pcre2>
  <order>srcip</order>
</decoder>

<decoder name="exim-syntax-errors">
  <parent>windows-date-format</parent>
  <prematch_pcre2 offset="after_parent">^SMTP call from </prematch_pcre2>
  <pcre2 offset="after_prematch">\[(\S+)\]:\d+ dropped: too many syntax or protocol errors</pcre2>
  <order>srcip</order>
</decoder>

<!-- NSD
   - Aug 11 13:21:46 ix nsd[16565]: server initialization failed, nsd could not be started
   - Aug 11 13:22:14 ix nsd[13816]: blocked.hosts:2: syntax error
   - Aug 11 13:22:14 ix nsd[13816]: blocked.hosts:2: unrecognized RR type 'name:'
   - Aug 12 09:01:00 junction.example.com nsd[7405]: NSTATS 1439384460 1439314258 A=1 AAAA=1
   - Aug 12 09:01:00 junction.example.com nsd[7405]: XSTATS 1439384460 1439314258 RR=0 RNXD=0 RFwdR=0 RDupR=0 RFail=0 RFErr=0 RErr=0 RAXFR=0 RLame=0 ROpts=0 SSysQ=0 SAn
s=2 SFwdQ=0 SDupQ=0 SErr=0 RQ=2 RIQ=0 RFwdQ=0 RDupQ=0 RTCP=0 SFwdR=0 SFail=0 SFErr=0 SNaAns=0 SNXD=0 RUQ=0 RURQ=0 RUXFR=0 RUUpd=0
   - Dec 16 12:51:17 pine nsd[90235]: xfrd: zone example.com received error code NOT IMPL from 192.168.17.9@153
-->

<decoder name="nsd">
  <program_name_pcre2>^nsd</program_name_pcre2>
</decoder>

<decoder name="nsd-from">
  <parent>nsd</parent>
  <pcre2> from (\S+)@| from (\S+)</pcre2>
  <order>srcip</order>
</decoder>

<!-- ownCloud
   - Examples owncloud.log (Note that the syntax of failed login logs differs between oler and newer ownCloud versions):
   - {"reqId":"Jrd4fkwIcXhVjtP8qODR","level":2,"time":"2017-09-20T15:44:23+02:00","remoteAddr":"127.0.0.1","user":"--","app":"core","method":"POST","url":"\/login","message":"Login failed: 'admin' (Remote IP: '127.0.0.1')"}
   - {"reqId":"wlioIFa6pOvt6DIAoeHE","remoteAddr":"127.0.0.1","app":"core","message":"Login failed: 'admin' (Remote IP: '127.0.0.1')","level":2,"time":"2016-04-12T22:28:20+02:00","method":"POST","url":"\/","user":"--"}
   - {"reqId":"prLlx9+QIfl1jHtz9C5o","remoteAddr":"127.0.0.1","app":"core","message":"Login failed: 'admin' (Remote IP: '127.0.0.1')","level":2,"time":"2015-07-08T12:12:41+02:00"}
   - {"reqId":"wLP7a3MdzTo8wgCWret9","remoteAddr":"127.0.0.1","app":"core","message":"Login failed: 'admin' (Remote IP: '127.0.0.1')","level":2,"time":"2015-07-15T09:40:35+02:00","method":"POST","url":"\/"}
   - {"reqId":"prLlx9+QIfl1jHtz9C5o","remoteAddr":"127.0.0.1","app":"core","message":"Login failed: 'admin' (Remote IP: '127.0.0.1)","level":2,"time":"2015-07-08T12:12:41+02:00"}
   - {"reqId":"wLP7a3MdzTo8wgCWret9","remoteAddr":"127.0.0.1","app":"core","message":"Login failed: 'admin' (Remote IP: '127.0.0.1)","level":2,"time":"2015-07-15T09:40:35+02:00","method":"POST","url":"\/"}
   - {"reqId":"f7906a8355f496e3a1947d7839c4a2c3","remoteAddr":"127.0.0.1","app":"core","message":"Login failed: 'admin' (Remote IP: '127.0.0.1', X-Forwarded-For: '')","level":2,"time":"2015-06-09T08:17:43+00:00"}
   - {"reqId":"9f8edc5558b2b4f8628663d83a092a7f","remoteAddr":"127.0.0.1","app":"core","message":"Login failed: 'admin' (Remote IP: '127.0.0.1', X-Forwarded-For: '')","level":2,"time":"2015-06-09T08:19:02   - +00:00","method":"POST","url":"\/cloud\/index.php"}
   - {"app":"core","message":"Login failed: 'admin' (Remote IP: '127.0.0.1', X-Forwarded-For: '')","level":2,"time":"2015-06-09T08:16:29+00:00"}
   - {"reqId":"5576a04643d8e","app":"core","message":"Login failed: 'admin' (Remote IP: '127.0.0.1', X-Forwarded-For: '')","level":2,"time":"2015-06-09T08:13:58+00:00","method":"POST","url":"\/owncloud\/index.php"}
   - {"app":"core","message":"Login failed: user 'admin' , wrong password, IP:127.0.0.1","level":2,"time":"2015-06-09T08:10:29+00:00"}
   - {"reqId":"55769fcacd1e0","app":"core","message":"Login failed: user 'admin' , wrong password, IP:127.0.0.1","level":2,"time":"2015-06-09T08:11:54+00:00","method":"POST","url":"\/owncloud\/index.php"}
   - {"reqId":"BaW6nfA5rHBoihjDtQVm","remoteAddr":"127.0.0.1","app":"core-preview","message":"Passed filename is not valid, might be malicious (file:\"test\";ip:\"127.0.0.1\")","level":2,"time":"2017-09-01T22:11:25+02:00","method":"POST","url":"\/login","user":"--"}
   - {"reqId":"4ETnKW0UyDBNmL4z\/umV","remoteAddr":"127.0.0.1","app":"PHP","message":"Redis::connect(): connect() failed: No such file or directory at \/var\/www\/owncloud\/lib\/private\/RedisFactory.php#60","level":3,"time":"2017-08-21T16:00:34+02:00","method":"PROPFIND","url":"\/remote.php\/dav\/addressbooks\/users\/admin\/example\/","user":"admin"}
   - {"reqId":"4j2DKpvOh0OezXVwfuLO","remoteAddr":"127.0.0.1","app":"PHP","message":"fopen(\/var\/www\/owncloud\/data\/user 1\/thumbnails\/1234\/32-32.png): failed to open stream: No such file or directory at \/var\/www\/owncloud\/lib\/private\/Files\/Storage\/Local.php#278","level":3,"time":"2017-07-15T23:59:20+02:00","method":"GET","url":"\/core\/preview.png?file=%2Fexample.txt&c=123&x=32&y=32&forceIcon=0","user":"user 1"}

   - Examples syslog:
   - Sep  1 20:16:09 foo ownCloud[15463]: {core} Login failed: 'test' (Remote IP: '127.0.0.1')
   - Sep  1 22:16:33 foo ownCloud[15467]: {core-preview} Passed filename is not valid, might be malicious (file:"test";ip:"127.0.0.1")
-->

<decoder name="owncloud">
  <prematch_pcre2>^\{"reqId":"\S+","message":".+","level":\d,"time":".+"\}$|^\{"app":"\S+","message":".+","level":\d,"time":".+"\}$|^\{"reqId":"\S+","level":\d,"time":"\S+","message":".+"\}$</prematch_pcre2>
</decoder>

<!-- Note: This defaults to "ownCloud" but users can change the syslog tag: https://github.com/owncloud/core/blob/v10.0.2/config/config.sample.php#L608-L614 -->
<decoder name="owncloud">
  <program_name_pcre2>^ownCloud</program_name_pcre2>
</decoder>

<decoder name="owncloud-failed1">
  <parent>owncloud</parent>
  <prematch_pcre2>Login failed: user </prematch_pcre2>
  <pcre2 offset="after_prematch">^'([A-Za-z0-9@_-]+)' , wrong password, IP:(\S+)</pcre2>

  <order>user, srcip</order>
</decoder>

<decoder name="owncloud-failed2">
  <parent>owncloud</parent>

  <prematch_pcre2>Login failed: </prematch_pcre2>
  <pcre2 offset="after_prematch">^'([A-Za-z0-9@_-]+)' \(Remote IP: '(\S+)'|^'([A-Za-z0-9@_-]+)' \(Remote IP: '(\S+)\)</pcre2>
  <order>user, srcip</order>
</decoder>

<decoder name="owncloud-malicious">
  <parent>owncloud</parent>

  <prematch_pcre2>Passed filename is not valid, might be malicious </prematch_pcre2>
  <pcre2 offset="after_prematch">;ip:"(\S+)"|;ip:\\"(\S+)\\"</pcre2>

  <order>srcip</order>
</decoder>

<decoder name="owncloud-loglevel">
  <parent>owncloud</parent>
  <prematch_pcre2>","level":</prematch_pcre2>
  <pcre2 offset="after_prematch">^(\d),"</pcre2>
  <order>status</order>
</decoder>

<!-- psad
  - Examples: (Note: IPv6 untested)
  - Sep  8 22:52:30 sni psad: scan detected (Nmap -sT or -sS scan): 212.83.152.232 -> 1.2.3.4 tcp: [21943] flags: SYN tcp pkts: 3 DL: 3
  - Sep  9 08:36:30 sni psad: src: 62.210.167.199 signature match: "BACKDOOR DoomJuice file upload attempt" (sid: 2375) tcp port: 3180
  - Sep  9 08:36:30 sni psad: scan detected (Masscan SYN scan): 62.210.167.199 -> 1.2.3.4 tcp: [3320-62210] flags: SYN tcp pkts: 10 DL: 3
  - Sep  3 14:18:52 sni psad: scan detected ( -sU scan): 192.168.1.42 -> 239.255.255.250 udp: [1900] udp pkts: 16 DL: 3
  - Sep  4 11:33:23 sni psad: src: 46.17.46.8 signature match: "MISC Microsoft PPTP communication attempt" (sid: 100082) tcp port: 1723
  - Sep  4 11:33:23 sni psad: src: 46.17.46.8 signature match: "DOS iParty DOS attempt" (sid: 1605) tcp port: 6004
  - Sep  4 11:33:23 sni psad: src: 46.17.46.8 signature match: "DOS Real Audio Server communication attempt" (sid: 100112) tcp port: 7070
  - Sep  4 11:33:23 sni psad: src: 46.17.46.8 signature match: "BACKDOOR DoomJuice file upload attempt" (sid: 2375) tcp port: 3129
  - Aug  9 16:46:32 dsc psad: message repeated 2 times: [ scan detected (Nmap -sT or -sS scan): 10.1.0.15 -> 192.168.1.18 tcp: [80] flags: SYN tcp pkts: 3 DL: 3]example logs: 
-->

<decoder name="psad">
  <program_name_pcre2>psad</program_name_pcre2>
</decoder>

<decoder name="psad-scan">
  <parent>psad</parent>
  <prematch_pcre2>^scan detected </prematch_pcre2>
  <pcre2 offset="after_prematch"> (\S+) -> (\S+) .+ DL: (\d)</pcre2>
  <order>srcip,dstip,status</order>
</decoder>

<decoder name="psad-repeated">
  <parent>psad</parent>
  <prematch_pcre2>^message repeated</prematch_pcre2>
  <pcre2 offset="after_prematch"> (\S+) -> (\S+) .+ DL: (\d)</pcre2>
  <order>srcip,dstip,status</order>
</decoder>

<decoder name="psad-signature">
  <parent>psad</parent>
  <prematch_pcre2>signature match: </prematch_pcre2>
  <pcre2 offset="after_parent">src: (\S+) signature match: .+ port: (\d+)</pcre2>
  <order>srcip,dstport</order>
</decoder>

<!-- Proxmox Virtual Environment (Proxmox VE)
   - Examples syslog:
   - Sep 10 22:12:41 example pvedaemon[6427]: authentication failure; rhost=192.168.0.1 user=root@pam msg=Authentication failure
   - Sep 10 22:12:49 example pvedaemon[6428]: authentication failure; rhost=192.168.0.1 user=root@pve msg=no such user ('root@pve')
   - Sep 10 22:12:54 example pvedaemon[6428]: <root@pam> successful auth for user 'root@pam'
   - Sep 10 22:13:44 example pvedaemon[6427]: <root@pam> starting task UPID:example:00000000:11111111:22222222:vzstart:100:root@pam:
   - Sep 10 22:13:44 example pvedaemon[13735]: starting CT 100: UPID:example:00000000:11111111:22222222:vzstart:100:root@pam:
   - Sep 10 22:13:46 example pvedaemon[6427]: <root@pam> end task UPID:example:00000000:11111111:22222222:vzstart:100:root@pam: OK
   - Sep 10 22:13:47 example pvestatd[1892]: modified cpu set for lxc/100: 4
   - Sep 10 06:25:44 example pveproxy[15342]: received signal TERM
   - Sep 10 06:25:44 example pveproxy[15342]: server closing
   - Sep 10 06:25:44 example pveproxy[15345]: worker exit
   - Sep 10 06:25:44 example pveproxy[15344]: worker exit
   - Sep 10 06:25:44 example pveproxy[15343]: worker exit
   - Sep 10 06:25:44 example pveproxy[15342]: worker 15343 finished
   - Sep 10 06:25:44 example pveproxy[15342]: worker 15344 finished
   - Sep 10 06:25:44 example pveproxy[15342]: worker 15345 finished
   - Sep 10 06:25:44 example pveproxy[15342]: server stopped
   - Sep 10 06:25:45 example pveproxy[22375]: Using '/etc/pve/local/pveproxy-ssl.pem' as certificate for the web interface.
   - Sep 10 06:25:45 example pveproxy[22413]: starting server
   - Sep 10 06:25:45 example pveproxy[22413]: starting 3 worker(s)
   - Sep 10 06:25:45 example pveproxy[22413]: worker 22414 started
   - Sep 10 06:25:45 example pveproxy[22413]: worker 22415 started
   - Sep 10 06:25:45 example pveproxy[22413]: worker 22416 started
   - Sep 10 06:25:47 example pvepw-logger[15428]: received terminate request (signal)
   - Sep 10 06:25:47 example pvepw-logger[15428]: stopping pvefw logger
   - Sep 10 06:25:48 example pvepw-logger[22551]: starting pvefw logger
-->

<decoder name="pvedaemon">
  <program_name_pcre2>^pvedaemon</program_name_pcre2>
</decoder>

<decoder name="pvestatd">
  <program_name_pcre2>^pvestatd</program_name_pcre2>
</decoder>

<decoder name="pveproxy">
  <program_name_pcre2>^pveproxy</program_name_pcre2>
</decoder>

<decoder name="pvepw-logger">
  <program_name_pcre2>^pvepw-logger</program_name_pcre2>
</decoder>

<decoder name="pvedaemon-auth-failed">
  <parent>pvedaemon</parent>
  <prematch_pcre2>authentication failure; </prematch_pcre2>
  <pcre2 offset="after_prematch">^rhost=(\S+) user=(\S+)@pam msg=|^rhost=(\S+) user=(\S+)@pve msg=</pcre2>
  <order>srcip, user</order>
</decoder>

<decoder name="pvedaemon-auth-success">
  <parent>pvedaemon</parent>
  <prematch_pcre2>successful auth for user '</prematch_pcre2>
  <pcre2 offset="after_prematch">^(\S+)@pam'$|^(\S+)@pve'$</pcre2>
  <order>user</order>
</decoder>

<decoder name="dhcpd">
  <program_name_pcre2>^dhcpd$</program_name_pcre2>
</decoder>

<decoder name="dhcpd-data">
  <parent>dhcpd</parent>
  <pcre2 offset="after_parent">^(\S+) \S+ (\S+) \S+ (\S+) via (\S+)$</pcre2>
  <order>action, srcip, extra_data, extra_data</order>
</decoder>

<decoder name="dhcpd-ack">
  <parent>dhcpd</parent>
  <prematch_pcre2> acking </prematch_pcre2>
  <pcre2 offset="after_parent">already acking lease (\S+)</pcre2>
  <order>srcip</order>
</decoder>

<decoder name="dhcpd-release">
  <parent>dhcpd</parent>
  <prematch_pcre2>^IP address</prematch_pcre2>
  <pcre2 offset="after_parent">^IP address (\S+) </pcre2>
  <order>srcip</order>
</decoder>

<!-- OpenBSD httpd -->
<decoder name="openbsd-httpd">
  <prematch_pcre2> \[\d+/[A-Za-z0-9@_-]+/\d+:\d+:\d+:\d+ -\d+\] "</prematch_pcre2>
  <pcre2>^(\S+) (\S+) \S+ \S+ \[\d+/[A-Za-z0-9@_-]+/\d+:\d+:\d+:\d+ -\d+\] "(\S+) (\S+) HTTP/\d\.\d" (\d+?) \d$</pcre2>
  <order>url, srcip, protocol, url, status</order>
  <type>web-log</type>
</decoder>

<!-- dnsmasq -->
<decoder name="dnsmasq">
  <!--<program_name>^dnsmasq</program_name>-->
  <prematch_pcre2>^dnsmasq</prematch_pcre2>
</decoder>

<decoder name="dnsmasq2">
  <parent>dnsmasq</parent>
  <pcre2 offset="after_parent">^\[\d+\]: \d+ (\S+)/\d+ (\S+) (\S+) to (\S+)|</pcre2>
  <pcre2>^\[\d+\]: \d+ (\S+)/\d+ (\S+) (\S+) from (\S+)|</pcre2>
  <pcre2>^\[\d+\]: \d+ (\S+)/\d+ (\S+) (\S+) is (\S+)</pcre2>
  <order>srcip, action, url, extra_data</order>
</decoder>

<!-- Kaspersky Endpoint Security 10 for Linux -->
<!-- Kesl example Logs -->
<!-- Nov  5 00:11:21 hostname kesl: {"EventType": "AVBasesAreTotallyOutOfDate","EventId": "27336","TaskName": "Update","TaskId": "6","AVBasesDate": "2018-10-17 09:49:00"} -->
<!-- Oct 25 13:11:21 hostname kesl: {"EventType": "AVBasesAreOutOfDate","EventId": "27311","TaskName": "Update","TaskId": "6","AVBasesDate": "2018-10-17 09:49:00"} -->
<!-- Nov 10 13:19:27 hostname kesl: {"EventType": "UpdateError","EventId": "27381","TaskType": "Update","TaskName": "Update","TaskId": "6","RuntimeTaskId": "120"} -->
<!-- Nov 10 13:22:09 hostname kesl: {"EventType": "ThreatDetected","EventId": "27384","DetectName": "EICAR-Test-File","DetectType": "Virware","DetectCertainty": "Sure","DetectSource": "Local","FileName": "/home/userlogin/eicar.com","ObjectName": "File","TaskId": "1","RuntimeTaskId": "20","TaskName": "File_Monitoring","TaskType": "OAS","AccessUser": "root","AccessUserId": "0","FileOwner": "root","FileOwnerId": "0"} -->
<!-- Nov 14 13:50:01 hostname kesl: {"EventType": "ObjectSavedToBackup","EventId": "27448","FileName": "/home/userlogin/eicar.com","ObjectName": "File","TaskId": "1","RuntimeTaskId": "126","TaskName": "File_Monitoring","TaskType": "OAS","AccessUser": "userlogin","AccessUserId": "1000","FileOwner": "root","FileOwnerId": "0"} -->
<!-- Nov 14 13:50:01 hostname kesl: {"EventType": "ObjectNotDisinfected","EventId": "27449","ObjectNotDisinfectedReason": "NonCurable","FileName": "/home/userlogin/eicar.com","ObjectName": "File","TaskId": "1","RuntimeTaskId": "126","TaskName": "File_Monitoring","TaskType": "OAS","AccessUser": "userlogin","AccessUserId": "1000","FileOwner": "root","FileOwnerId": "0"} -->
<!-- Nov 14 13:50:01 hostname kesl: {"EventType": "ObjectDeleted","EventId": "27450","FileName": "/home/userlogin/eicar.com","ObjectName": "File","TaskId": "1","RuntimeTaskId": "126","TaskName": "File_Monitoring","TaskType": "OAS","AccessUser": "userlogin","AccessUserId": "1000","FileOwner": "root","FileOwnerId": "0"} -->
<!-- Nov 14 12:44:04 hostname kesl: {"EventType": "TaskStateChanged","EventId": "27438","TaskName": "Update","TaskType": "Update","TaskId": "6","TaskState": "Starting","PrevTaskState": "Stopped","TaskRequestInitiator": "User","RuntimeTaskId": "127"} -->
<!-- Nov 14 12:44:04 hostname kesl: {"EventType": "TaskStateChanged","EventId": "27439","TaskName": "Update","TaskType": "Update","TaskId": "6","TaskState": "Started","PrevTaskState": "Starting","TaskRequestInitiator": "User","RuntimeTaskId": "127"} -->

<decoder name="kesl">
  <program_name_pcre2>^kesl</program_name_pcre2>
</decoder>

<decoder name="kesl-avbases-old">
  <parent>kesl</parent>
  <prematch_pcre2>^""EventType": "\S+","EventId": "\d+?","TaskName": "\S+","TaskId": "\d+?","AVBasesDate": "\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2}""</prematch_pcre2>
  <pcre2 offset="after_parent">^""EventType": "(\S+)","EventId": "(\d+?)","TaskName": "(\S+)","TaskId": "\d+?","AVBasesDate": "(\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2})""</pcre2>
  <order>status, id, action, extra_data</order> 
</decoder>

<decoder name="kesl-threat-detected">
  <parent>kesl</parent>
  <prematch_pcre2>^""EventType": "\S+","EventID": "\d+","DetectName": "\S+","DetectType": "\S+","DetectCertainty": "\S+","DetectSource": "\S+","FileName": "\S+,"ObjectName": "\S+","TaskId": "\d+?","RuntimeTaskId": "\d+","TaskName": "\S+","TaskType": "\S+","AccessUser": "\S+","AccessUserId": "\d+","FileOwner": "\S+","FileOwnerId": "\d+""</prematch_pcre2>
  <pcre2 offset="after_parent">^""EventType": "(\S+)","EventID": "(\d+)","DetectName": "\S+","DetectType": "\S+","DetectCertainty": "(\S+)","DetectSource": "\S+","FileName": \S+,"ObjectName": "\S+","TaskId": "\d+","RuntimeTaskId": "\d+?","TaskName": "\S+","TaskType": "(\S+)","AccessUser": "\S+","AccessUserId": "\d+?","FileOwner": "\S+","FileOwnerId": "\d+""</pcre2>
  <order>status, id, extra_data, action</order>
</decoder>

<decoder name="kesl-taskstatechange">
  <parent>kesl</parent>
  <prematch_pcre2>^""EventType": "\S+","EventId": "\d+","TaskName": "\S+","TaskType": "\S+","TaskId": "\d+","TaskState": "\S+","PrevTaskState": "\S+","TaskRequestInitiator": "\S+","RuntimeTaskId": "\d+""</prematch_pcre2>
  <pcre2 offset="after_parent">^""EventType": "(\S+)","EventId": "(\d+)","TaskName": "\S+","TaskType": "(\S+)","TaskId": "\d+","TaskState": "(\S+)","PrevTaskState": "\S+","TaskRequestInitiator": "(\S+)","RuntimeTaskId": "\d+""</pcre2>
  <order>action, id, extra_data, status, srcuser</order>
</decoder>

<!-- MHN - Json log decoder - Dionaea -->
<!-- include /var/log/mhn/mhn-json.log to ossec.conf -->
<!-- {"direction": "inbound", "protocol": "ip", "ids_type": "network", "timestamp": "2018-09-14T11:02:54.215411", "dionaea_action": "reject", "type": "dionaea.connections", "app": "dionaea", "src_ip": "16.10.10.10", "vendor_product": "Dionaea", "dest_port": 365, "signature": "Connection to Honeypot", "src_port": 45302, "dest_ip": "16.10.10.11", "sensor": "5e7031cf-b74d-22f9-57e0-254166752457", "transport": "tcp", "severity": "high"} -->
<decoder name="dionaea">
  <prematch_pcre2>dionaea\.connections</prematch_pcre2>
  <pcre2>^\{"direction": "(\S+)", "protocol": "(\S+)", "ids_type": "\S+", "timestamp": "\d{4}-\d{2}-\d{2}\w\d{2}:\d{2}:\d{2}.\d+", "dionaea_action": "(\S+)", "type": "dionaea\.connections", "app": "dionaea", "src_ip": "(\S+)", "vendor_product": "Dionaea", "dest_port": (\d+), "signature": ".+", "src_port": (\d+?), "dest_ip": "(\S+)", "sensor": \S+, "transport": "\S+", "severity": "\S+"\}</pcre2>
  <order>extra_data, protocol, action, srcip, dstport, srcport, dstip</order>
</decoder>

<!-- MHN - Json log decoder - Cowrie -->
<!-- include /var/log/mhn/mhn-json.log to ossec.conf -->
<!-- {"direction": "inbound", "protocol": "ip", "ids_type": "network", "ssh_username": "admin", "app": "cowrie", "transport": "tcp", "dest_port": 22, "src_port": 45302, "severity": "high", "timestamp": "2018-10-23T11:22:36.597864", "vendor_product": "Cowrie", "sensor": "5e7031cf-b74d-22f9-57e0-254166752457", "src_ip": "16.10.10.10", "ssh_password": "password", "signature": "SSH login attempted on cowrie honeypot", "ssh_version": "'SSH-2.0-Sun_SSH_1.1.4'", "type": "cowrie.sessions", "dest_ip": "16.10.10.11"} -->
<!-- {"direction": "inbound", "protocol": "ip", "ids_type": "network", "timestamp": "2018-10-23T07:45:56.937787", "vendor_product": "Cowrie", "type": "cowrie.sessions", "app": "cowrie", "src_ip": "16.10.10.10", "dest_port": 22, "signature": "SSH session on cowrie honeypot", "ssh_version": "'SSH-2.0-Sun_SSH_1.1.4'", "src_port": 45302, "dest_ip": "16.10.10.11", "sensor": "5e7031cf-b74d-22f9-57e0-254166752457", "transport": "tcp", "severity": "high"} -->
<!-- {"direction": "inbound", "protocol": "ip", "ids_type": "network", "timestamp": "2018-11-14T10:32:38.686578", "app": "cowrie", "transport": "tcp", "dest_port": 22, "src_port": 45302, "severity": "high", "vendor_product": "Cowrie", "sensor": "5e7031cf-b74d-22f9-57e0-254166752457", "src_ip": "16.10.10.10", "command": "whoami", "signature": "command attempted on cowrie honeypot", "ssh_version": "'SSH-2.0-OpenSSH_7.4p1 Debian-10+deb9u4'", "type": "cowrie.sessions", "dest_ip": "16.10.10.11"} -->

<decoder name="cowrie">
  <prematch_pcre2>cowrie\.sessions</prematch_pcre2>
</decoder>

<decoder name="cowrie-attempt">
  <parent>cowrie</parent>
  <prematch_pcre2>"SSH login attempted</prematch_pcre2>
  <pcre2>^\{"direction": "\S+", "protocol": "(\S+)", "ids_type": "(\S+)", "ssh_username": "(\S+)", "app": "cowrie", "transport": "\S+", "dest_port": (\d+), "src_port": (\d+), "severity": "\S+", "timestamp": "\d{4}-\d{2}-\d{2}", "vendor_product": "Cowrie", "sensor": \S+, "src_ip": "(\S+)", "ssh_password": "\S+", "signature": "(.+)", "ssh_version": .+, "type": "cowrie\.sessions", "dest_ip": "(\S+)"\}</pcre2>
  <order>protocol, extra_data, user, dstport, srcport, srcip, action, dstip</order>
</decoder>

<decoder name="cowrie-session">
  <parent>cowrie</parent>
  <prematch_pcre2>"SSH session on cowrie honeypot</prematch_pcre2>
  <pcre2>^\{"direction": "\S+", "protocol": "(\S+)", "ids_type": "(\S+)", "timestamp": "\d{4}-\d{2}-\d{2}\w\d{2}:\d{2}:\d{2}.\d+", "vendor_product": "Cowrie", "type": "cowrie\.sessions", "app": "cowrie", "src_ip": "(\S+)", "dest_port": (\d+?), "signature": "(.+)", "ssh_version": .+, "src_port": (\d+?), "dest_ip": "(\S+)", "sensor": \S+, "transport": "\S+", "severity": "\S+"\}</pcre2>
  <order>protocol, extra_data, srcip, dstport, action, srcport, dstip</order>
</decoder>

<decoder name="cowrie-command">
  <parent>cowrie</parent>
  <prematch_pcre2>"command attempted on cowrie honeypot</prematch_pcre2>
  <pcre2>^\{"direction": "\S+", "protocol": "(\S+)", "ids_type": "(\S+)", "timestamp": "\d{4}-\d{2}-\d{2}\w\d{2}:\d{2}:\d{2}.\d+", "app": "cowrie", "transport": "\S+", "dest_port": (\d+?), "src_port": (\d+?), "severity": "\S+", "vendor_product": "Cowrie", "sensor": \S+, "src_ip": "(\S+)", "command": "\S+", "signature": "(.+)", "ssh_version": .+, "type": "cowrie\.sessions", "dest_ip": "(\S+)"\}</pcre2>
  <order>protocol, extra_data, dstport, srcport, srcip, action, dstip</order>
</decoder>

<!-- EOF -->
